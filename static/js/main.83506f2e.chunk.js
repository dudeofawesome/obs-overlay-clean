(this["webpackJsonpobs-overlay-clean"]=this["webpackJsonpobs-overlay-clean"]||[]).push([[0],{223:function(e,t,n){e.exports=n(359)},228:function(e,t,n){},230:function(e,t,n){},295:function(e,t){},350:function(e,t,n){},351:function(e,t,n){},352:function(e,t,n){},353:function(e,t,n){},354:function(e,t,n){},355:function(e,t,n){},356:function(e,t,n){},357:function(e,t,n){},358:function(e,t,n){},359:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(17),o=n.n(a),s=(n(228),n(229),n(95)),c=n(52),l=n(40),u=n(24),f=(n(230),n(9)),d=n.n(f),h=n(14),v=n(11),_=n(16);function m(e,t){var n;null==t[e]&&(t[e]=null!==(n=localStorage.getItem("".concat(t.prefix,"_").concat(e)))&&void 0!==n?n:void 0);return t[e]}function p(e,t){if(null==t[e]){var n=localStorage.getItem("".concat(t.prefix,"_").concat(e));t[e]="true"===n||"false"!==n&&void 0}return t[e]}function b(e,t){if(null==t[e]){var n=localStorage.getItem("".concat(t.prefix,"_").concat(e));return null!=n?u.DateTime.fromMillis(parseInt(n)):void 0}return t[e]}function w(e,t,n){n[e]=t,null!=t?localStorage.setItem("".concat(n.prefix,"_").concat(e),t):localStorage.removeItem("".concat(n.prefix,"_").concat(e))}function y(e,t,n){n[e]=t,null!=t?localStorage.setItem("".concat(n.prefix,"_").concat(e),t?"true":"false"):localStorage.removeItem("".concat(n.prefix,"_").concat(e))}function g(e,t,n){n[e]=t,null!=t?localStorage.setItem("".concat(n.prefix,"_").concat(e),t.toMillis()+""):localStorage.removeItem("".concat(n.prefix,"_").concat(e))}var k=function(){function e(){Object(v.a)(this,e),this._settings=new E}return Object(_.a)(e,[{key:"getSpotifyStatus",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null!=this.auth_token_exp&&this.auth_token_exp>=u.DateTime.local())){e.next=7;break}return e.next=3,fetch("https://api.spotify.com/v1/me/player/currently-playing",{headers:{Authorization:"Bearer ".concat(this.auth_token)}}).then((function(e){return"0"===e.headers.get("Content-Length")?null:e.json()})).then((function(e){if(null!=e){if(null!=e.error)throw e;return e}})).catch((function(e){if(null!=e.error)throw"The access token expired"===e.error.message?(console.error(e.error),new Error(e.error.message)):(e.error.message,console.error(e.error),new Error(e.error.message));if(!e.message.startsWith("JSON.parse: unexpected end of data"))throw new Error(e)}));case 3:return t=e.sent,e.abrupt("return",t);case 7:return console.error("Spotify token is expired"),e.next=10,this.launchSpotifyOAuth();case 10:if(!(null!=this.auth_token_exp&&this.auth_token_exp>=u.DateTime.local())){e.next=16;break}return e.next=13,this.getSpotifyStatus();case 13:return e.abrupt("return",e.sent);case 16:throw console.log("Spotify token is still expired"),new Error("Spotify token is still expired");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"launchSpotifyOAuth",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(n,i){var r,a="".concat(window.location.origin,"/oauth/spotify"),o="https://accounts.spotify.com/authorize?client_id=".concat(e.client_id,"&")+"response_type=token&"+"redirect_uri=".concat(a,"&")+"scope=user-read-currently-playing",s=document.createElement("iframe");s.src=o,document.body.appendChild(s),t?r=window.setTimeout((function(){i(new Error("Timed out")),s.remove()}),5e3):(s.className="window active",s.style.position="fixed",s.style.top="0px",s.style.left="0px",s.style.marginTop="50%",s.style.marginLeft="50%",s.style.width="400px",s.style.height="500px",s.style.transform="translate(-50%, -50%)");window.addEventListener("message",(function e(t){console.log(t),"object"===typeof t.data&&"Spotify OAuth"===t.data.type&&(null!=r&&window.clearTimeout(r),s.remove(),window.removeEventListener("message",e),t.data.href.startsWith("http")?n():i())}),!1)}))}},{key:"enabled",set:function(e){y("enabled",e,this._settings)},get:function(){return p("enabled",this._settings)}},{key:"client_id",set:function(e){w("client_id",e,this._settings)},get:function(){var e;return null!==(e=m("client_id",this._settings))&&void 0!==e?e:"90f61a9875dc44a28faf437b70e8b01b"}},{key:"auth_code",set:function(e){w("auth_code",e,this._settings)},get:function(){return m("auth_code",this._settings)}},{key:"refresh_token",set:function(e){w("refresh_token",e,this._settings)},get:function(){return m("refresh_token",this._settings)}},{key:"auth_token",set:function(e){w("auth_token",e,this._settings)},get:function(){return m("auth_token",this._settings)}},{key:"auth_token_exp",set:function(e){g("auth_token_exp",e,this._settings)},get:function(){return b("auth_token_exp",this._settings)}}]),e}(),E=function e(){Object(v.a)(this,e),this.prefix="spotify",this.enabled=void 0,this.client_id=void 0,this.auth_code=void 0,this.refresh_token=void 0,this.auth_token=void 0,this.auth_token_exp=void 0};function x(){var e=Object(c.f)(),t=Object(i.useState)(""),n=Object(l.a)(t,2),a=n[0],o=n[1];return Object(i.useEffect)((function(){var t=(""!==window.location.hash?window.location.hash:window.location.search).split(/[?&#]/).filter((function(e){return""!==e})).map((function(e){return e.split("=")})).reduce((function(e,t){return e.set(t[0],t[1])}),new Map);if(console.log(t),t.has("access_token")&&t.has("expires_in")){var n=t.get("access_token"),i=parseInt(t.get("expires_in"));console.log(n,i);var r=new k;r.auth_token=n,r.auth_token_exp=u.DateTime.local().plus(1e3*i),window.opener?(window.opener.postMessage({type:"Spotify OAuth",href:window.location.href}),window.close()):window.parent?window.parent.postMessage({type:"Spotify OAuth",href:window.location.href},"*"):e.push("/")}else o("Missing params")}),[e]),r.a.createElement("div",null,r.a.createElement("div",null,"Redirecting\u2026"),a)}function O(){var e=Object(c.f)(),t=Object(i.useState)(""),n=Object(l.a)(t,2),a=n[0],o=n[1];return Object(i.useEffect)((function(){var t=(""!==window.location.hash?window.location.hash:window.location.search).split(/[?&#]/).filter((function(e){return""!==e})).map((function(e){return e.split("=")})).reduce((function(e,t){return e.set(t[0],t[1])}),new Map);if(console.log(t),t.has("code")){var n=t.get("code");console.log(n),window.opener?(window.opener.postMessage({type:"Twitch OAuth",auth_code:n}),window.close()):window.parent?window.parent.postMessage({type:"Twitch OAuth",auth_code:n},"*"):e.push("/")}else o("Missing params")}),[e]),r.a.createElement("div",null,r.a.createElement("div",null,"Redirecting\u2026"),a)}var j=n(19),S=n(22),C=n(23),D=n(400),T=n(401),N=n(406),I=n(402),M=n(404),A=n(201),P=n.n(A),q=n(395),L=n(62),R=n(390),W=n(393),U=n(394),z=n(409),B=n(396),F=n(412),V=n(405),J=n(414),X=function(){function e(){Object(v.a)(this,e),this._settings=new Y}return Object(_.a)(e,[{key:"getMediaDevices",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=navigator.mediaDevices)||void 0===t?void 0:t.enumerateDevices();case 2:return e.abrupt("return",e.sent.filter((function(e){return"videoinput"===e.kind})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"media_device_id",get:function(){return m("media_device_id",this._settings)},set:function(e){w("media_device_id",e,this._settings)}},{key:"enabled",get:function(){return p("enabled",this._settings)},set:function(e){y("enabled",e,this._settings)}},{key:"autofocus",get:function(){return p("autofocus",this._settings)},set:function(e){y("autofocus",e,this._settings)}}]),e}(),Y=function e(){Object(v.a)(this,e),this.prefix="camera",this.media_device_id=void 0,this.enabled=void 0,this.autofocus=void 0},Z=n(81),$=n.n(Z),G=n(195),H=n.n(G),K=n(410),Q=n(407),ee=function(){function e(){Object(v.a)(this,e),this._settings=new te,this._client=void 0,this._pubsub_client=void 0,this._subscriber_listener=void 0,this._follower_check_timer=void 0,this._scopes=["chat:read","channel_subscriptions"],this._new_follower=void 0,this._new_subscriber=void 0,this._new_donation=void 0,this._new_donation_bits=void 0,this._new_raid=void 0}return Object(_.a)(e,[{key:"authenticate",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(window.location.origin,"/oauth/twitch"),e.next=3,this.launchTwitchOAuth();case 3:return n=e.sent,e.next=6,fetch("https://id.twitch.tv/oauth2/token?"+"client_id=".concat(this.client_id,"&")+"client_secret=".concat(this.client_secret,"&")+"code=".concat(n,"&")+"grant_type=authorization_code&"+"redirect_uri=".concat(t),{method:"POST"}).then((function(e){return e.json()})).then((function(e){if(null!=e.access_token)return e;throw e}));case 6:i=e.sent,console.log(i),this.access_token=i.access_token,this.access_token_exp=u.DateTime.fromMillis(Date.now()+1e3*i.expires_in),this.refresh_token=i.refresh_token;case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"launchTwitchOAuth",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(n,i){var r,a="".concat(window.location.origin,"/oauth/twitch"),o="https://id.twitch.tv/oauth2/authorize?client_id=".concat(e.client_id,"&")+"response_type=code&"+"redirect_uri=".concat(a,"&")+"scope=".concat(e._scopes.join("+")),s=document.createElement("iframe");s.src=o,document.body.appendChild(s),t?r=window.setTimeout((function(){i(new Error("Timed out")),s.remove()}),5e3):(s.className="window active",s.style.position="fixed",s.style.top="0px",s.style.left="0px",s.style.marginTop="50%",s.style.marginLeft="50%",s.style.width="400px",s.style.height="500px",s.style.transform="translate(-50%, -50%)");window.addEventListener("message",(function e(t){console.log(t),"object"===typeof t.data&&"Twitch OAuth"===t.data.type&&(null!=r&&window.clearTimeout(r),s.remove(),window.removeEventListener("message",e),null!=t.data.auth_code?n(t.data.auth_code):i())}),!1)}))}},{key:"createClient",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.client_id){e.next=4;break}throw new Error("client_id is null");case 4:if(null!=this.user_name){e.next=8;break}throw new Error("user_id is null");case 8:if(null!=this.client_secret){e.next=12;break}throw new Error("client_secret is null");case 12:if(null!=this.refresh_token){e.next=16;break}throw new Error("refresh_token is null");case 16:return this._client=$.a.withCredentials(this.client_id,this.access_token,this._scopes,{clientSecret:this.client_secret,refreshToken:this.refresh_token,onRefresh:function(e){n.access_token=e.accessToken,n.access_token=e.refreshToken}}),e.next=19,this._client.helix.users.getUserByName(this.user_name);case 19:if(t=e.sent,console.log(t),null!=t){e.next=25;break}throw new Error("Couldn't find user ".concat(this.user_name));case 25:this.user_id=t.id;case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"subscribe",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this._client){e.next=6;break}return console.warn("_client is null. trying to create"),e.next=4,this.createClient();case 4:if(null!=this._client){e.next=6;break}throw new Error("_client is null");case 6:if(null!=this.user_id){e.next=10;break}throw new Error("user_id is null");case 10:if(null!=this.user_name){e.next=14;break}throw new Error("user_name is null");case 14:if(!this.notify_new_followers){e.next=21;break}if(null!=this.notify_new_followers_freq){e.next=17;break}throw new Error("notify_new_followers_freq is null");case 17:null==this._new_follower&&(this._new_follower=new K.a),t=this.notify_new_followers_freq.valueOf(),null!=this._follower_check_timer&&this._follower_check_timer.unsubscribe(),this._follower_check_timer=Object(Q.a)(t,t).subscribe(Object(h.a)(d.a.mark((function e(){var i,r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getFollowers();case 2:i=e.sent,console.log(i),r=i.data.findIndex((function(e){return u.DateTime.local().minus(t)>u.DateTime.fromJSDate(e.followDate)})),a=i.data.slice(0,r),console.log("NEW_FOLLOWERS"),console.log(a),0!==a.length&&(o=Object(Q.a)(0,t/(a.length+1)).subscribe((function(e){var t;if(console.log(e),null==a[e])throw new Error("new_followers index exceeded");null===(t=n._new_follower)||void 0===t||t.next(a[e]),e>=a.length-1&&o.unsubscribe()})));case 9:case"end":return e.stop()}}),e)}))));case 21:if(!this.notify_new_subscribers){e.next=29;break}return this._pubsub_client=new H.a,e.next=25,this._pubsub_client.registerUserListener(this._client);case 25:return null==this._new_subscriber&&(this._new_subscriber=new K.a),e.next=28,this._pubsub_client.onSubscription(this.user_id,(function(e){var t;console.log(e),null===(t=n._new_subscriber)||void 0===t||t.next(e),console.log("".concat(e.userDisplayName," just subscribed!"))}));case 28:this._subscriber_listener=e.sent;case 29:this.notify_donations&&console.warn("Donation notifications are not supported at this time"),this.notify_raids;case 31:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e;null===(e=this._subscriber_listener)||void 0===e||e.remove()}},{key:"getFollowers",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this._client){e.next=4;break}throw new Error("_client is null");case 4:if(null!=this.user_id){e.next=6;break}throw new Error("user_id is null");case 6:return e.next=8,this._client.helix.users.getFollows({followedUser:this.user_id});case 8:if(null!=(t=e.sent)){e.next=11;break}throw new Error("followers is null");case 11:return console.log(t),e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"new_follower",get:function(){return this._new_follower}},{key:"new_subscriber",get:function(){return this._new_subscriber}},{key:"new_donation",get:function(){return this._new_donation}},{key:"new_donation_bits",get:function(){return this._new_donation_bits}},{key:"new_raid",get:function(){return this._new_raid}},{key:"client_id",get:function(){var e;return null!==(e=m("client_id",this._settings))&&void 0!==e?e:"pbcwgkykya4jjufuuybfl91jn2zhro"},set:function(e){w("client_id",e,this._settings)}},{key:"client_secret",get:function(){return m("client_secret",this._settings)},set:function(e){w("client_secret",e,this._settings)}},{key:"access_token",get:function(){return m("access_token",this._settings)},set:function(e){w("access_token",e,this._settings)}},{key:"access_token_exp",get:function(){return b("access_token_exp",this._settings)},set:function(e){g("access_token_exp",e,this._settings)}},{key:"refresh_token",get:function(){return m("refresh_token",this._settings)},set:function(e){w("refresh_token",e,this._settings)}},{key:"user_id",get:function(){return m("user_id",this._settings)},set:function(e){w("user_id",e,this._settings)}},{key:"user_name",get:function(){var e;return null!==(e=m("user_name",this._settings))&&void 0!==e?e:"DudeOfAwesome"},set:function(e){w("user_name",e,this._settings)}},{key:"notify_new_followers",get:function(){return p("notify_new_followers",this._settings)},set:function(e){y("notify_new_followers",e,this._settings)}},{key:"notify_new_followers_freq",get:function(){var e;return null!==(e=function(e,t){if(null==t[e]){var n=localStorage.getItem("".concat(t.prefix,"_").concat(e));return null!=n?u.Duration.fromMillis(parseInt(n)):void 0}return t[e]}("notify_new_followers_freq",this._settings))&&void 0!==e?e:u.Duration.fromMillis(6e4)},set:function(e){var t,n,i;t="notify_new_followers_freq",n=e,(i=this._settings)[t]=n,null!=n?localStorage.setItem("".concat(i.prefix,"_").concat(t),n.valueOf()+""):localStorage.removeItem("".concat(i.prefix,"_").concat(t))}},{key:"notify_new_subscribers",get:function(){return p("notify_new_subscribers",this._settings)},set:function(e){y("notify_new_subscribers",e,this._settings)}},{key:"notify_donations",get:function(){return p("notify_donations",this._settings)},set:function(e){y("notify_donations",e,this._settings)}},{key:"notify_donations_bits",get:function(){return p("notify_donations_bits",this._settings)},set:function(e){y("notify_donations_bits",e,this._settings)}},{key:"notify_raids",get:function(){return p("notify_raids",this._settings)},set:function(e){y("notify_raids",e,this._settings)}}]),e}(),te=function e(){Object(v.a)(this,e),this.prefix="twitch",this.client_id=void 0,this.client_secret=void 0,this.access_token=void 0,this.access_token_exp=void 0,this.refresh_token=void 0,this.user_id=void 0,this.user_name=void 0,this.notify_new_followers=void 0,this.notify_new_followers_freq=void 0,this.notify_new_subscribers=void 0,this.notify_donations=void 0,this.notify_donations_bits=void 0,this.notify_raids=void 0},ne=new X,ie=Object(i.createContext)(ne);ie.displayName="CameraService";var re=new k,ae=Object(i.createContext)(re);ae.displayName="SpotifyService";var oe=new ee,se=Object(i.createContext)(oe);function ce(e){return r.a.createElement(ie.Provider,{value:ne},r.a.createElement(ae.Provider,{value:re},r.a.createElement(se.Provider,{value:oe},e.children)))}function le(e){return r.a.createElement("div",Object.assign({},e,{style:Object(j.a)({display:"flex",flexDirection:"row"},e.style)}),e.children)}function ue(e){return r.a.createElement(le,Object.assign({},e,{style:Object(j.a)({},e.style,{flexDirection:"column"})}),e.children)}function fe(e){return i.createElement("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},e.children)}se.displayName="TwitchService";n(93);var de=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var r;return Object(v.a)(this,n),(r=t.call(this,e)).camera_service=void 0,r.video_ref=Object(i.createRef)(),r.state={},r}return Object(_.a)(n,[{key:"componentDidMount",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n,i,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.camera_service=this.context,e.prev=1,e.next=4,null===(t=this.camera_service)||void 0===t?void 0:t.getMediaDevices();case 4:n=e.sent,this.setState((function(e){return Object(j.a)({},e,{devices:n})})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.setState((function(t){return Object(j.a)({},t,{test_successful:!1,test_error:e.t0.toString()})}));case 11:return e.prev=11,null!=(null===(i=this.camera_service)||void 0===i?void 0:i.media_device_id)&&""!==(null===(r=this.camera_service)||void 0===r?void 0:r.media_device_id)&&this.selectDeviceForPreview(this.camera_service.media_device_id),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[1,8,11,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"selectDeviceForPreview",value:function(){var e=Object(h.a)(d.a.mark((function e(t){var n,i,r,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null!==(n=null===(i=this.state.devices)||void 0===i?void 0:i.length)&&void 0!==n?n:0)>0&&null!=this.video_ref.current)){e.next=12;break}return e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:t}});case 4:r=e.sent,this.video_ref.current.srcObject=r,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:this.video_ref.current.addEventListener("loadeddata",(function(){var e;null===(e=a.video_ref.current)||void 0===e||e.play()}));case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement(fe,null,r.a.createElement(ie.Consumer,null,(function(t){var n,i,a;return r.a.createElement(le,null,r.a.createElement(R.a,{variant:"outlined",style:{marginRight:"15px"}},r.a.createElement(W.a,null,r.a.createElement(ue,null,r.a.createElement(U.a,{control:r.a.createElement(z.a,{defaultChecked:null!==(n=t.enabled)&&void 0!==n&&n,onChange:function(e){return t.enabled=e.target.checked},name:"Spotify Enabled"}),label:"Enable Camera"}),r.a.createElement(B.a,{disabled:null==e.state.devices||0===e.state.devices.length},r.a.createElement(F.a,{htmlFor:"device-select"},"Camera"),r.a.createElement(V.a,{id:"device-select",defaultValue:null!==(i=t.media_device_id)&&void 0!==i?i:"",onChange:function(n){t.media_device_id=n.target.value,e.selectDeviceForPreview(n.target.value)}},null===(a=e.state.devices)||void 0===a?void 0:a.map((function(e,t){return r.a.createElement(J.a,{key:t,value:e.deviceId},e.label.replace(/ \([a-z0-9]{4,4}:[a-z0-9]{4,4}\)$/,""))})))),r.a.createElement("video",{ref:e.video_ref,style:{maxWidth:"100%"}})))),r.a.createElement(ue,null,[r.a.createElement("div",null,e.state.test_res),e.state.test_error][0]))})))}}]),n}(i.Component);de.contextType=ie;var he=n(415),ve=n(399),_e=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).spotify_service=void 0,i.state={},i}return Object(_.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.spotify_service=this.context,this.setState((function(t){var n,i,r,a;return Object(j.a)({},t,{enabled:null!==(n=null===(i=e.spotify_service)||void 0===i?void 0:i.enabled)&&void 0!==n&&n,client_id:null!==(r=null===(a=e.spotify_service)||void 0===a?void 0:a.client_id)&&void 0!==r?r:"90f61a9875dc44a28faf437b70e8b01b"})}))}},{key:"testSpotifyAPI",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState((function(e){return Object(j.a)({},e,{test_successful:void 0})})),e.prev=1,e.next=4,null===(t=this.spotify_service)||void 0===t?void 0:t.getSpotifyStatus();case 4:n=e.sent,this.setState((function(e){var t;return Object(j.a)({},e,{test_successful:!0,test_res:null===n||void 0===n||null===(t=n.item)||void 0===t?void 0:t.name})})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.setState((function(t){return Object(j.a)({},t,{test_successful:!1,test_res:e.t0.message})}));case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement(fe,null,r.a.createElement(le,null,r.a.createElement(R.a,{variant:"outlined",style:{marginRight:"15px"}},r.a.createElement(W.a,null,r.a.createElement(ae.Consumer,null,(function(e){var t,n;return r.a.createElement(ue,null,r.a.createElement(U.a,{control:r.a.createElement(z.a,{defaultChecked:null!==(t=e.enabled)&&void 0!==t&&t,onChange:function(t){return e.enabled=t.target.checked},name:"Spotify Enabled"}),label:"Show Spotify Status"}),r.a.createElement(he.a,{id:"client_id",label:"Spotify Client ID",defaultValue:null!==(n=e.client_id)&&void 0!==n?n:"",required:!0,onChange:function(t){return e.client_id=t.target.value}}))})))),r.a.createElement(ue,null,r.a.createElement(ve.a,{variant:"contained",onClick:function(){var t;return null===(t=e.spotify_service)||void 0===t?void 0:t.launchSpotifyOAuth()}},"Authenticate"),r.a.createElement(ve.a,{onClick:function(){return e.testSpotifyAPI()}},"Test Spotify"),[r.a.createElement("div",null,this.state.test_res),this.state.test_error][0])))}}]),n}(i.Component);_e.contextType=ae;var me=n(362);function pe(){var e=Object(i.useState)(""),t=Object(l.a)(e,2),n=t[0],a=t[1];return r.a.createElement(fe,null,r.a.createElement(le,null,r.a.createElement(R.a,{variant:"outlined",style:{marginRight:"15px"}},r.a.createElement(W.a,null,r.a.createElement(be,null))),r.a.createElement(ue,null,r.a.createElement(R.a,{variant:"outlined",style:{marginRight:"15px"}},r.a.createElement(W.a,null,r.a.createElement(we,null))),r.a.createElement(se.Consumer,null,(function(e){return r.a.createElement(ue,null,r.a.createElement(ve.a,{variant:"contained",onClick:Object(h.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.authenticate();case 2:return t.next=4,e.createClient();case 4:case"end":return t.stop()}}),t)})))},"Authenticate"),r.a.createElement(ve.a,{onClick:Object(h.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.subscribe().then((function(){return"Success"})).catch((function(e){return e}));case 2:return t.t0=a,t.t1="",t.next=6,e.getFollowers();case 6:t.t2=t.sent.total,t.t3=t.t1.concat.call(t.t1,t.t2," followers"),(0,t.t0)(t.t3);case 9:case"end":return t.stop()}}),t)})))},"Test Twitch"),r.a.createElement("div",null,n))})))))}function be(){return r.a.createElement(ue,null,r.a.createElement(me.a,{style:{fontSize:"0.8rem"},color:"textSecondary",gutterBottom:!0},"Notifications"),r.a.createElement(se.Consumer,null,(function(e){var t,n,i,a,o;return[{label:"New followers",value:null!==(t=e.notify_new_followers)&&void 0!==t&&t,onChange:function(t){return e.notify_new_followers=t}},{label:"New subscribers",value:null!==(n=e.notify_new_subscribers)&&void 0!==n&&n,onChange:function(t){return e.notify_new_subscribers=t}},{label:"Donations",value:null!==(i=e.notify_donations)&&void 0!==i&&i,onChange:function(t){return e.notify_donations=t}},{label:"Bit donations",value:null!==(a=e.notify_donations_bits)&&void 0!==a&&a,onChange:function(t){return e.notify_donations_bits=t}},{label:"Raids / hosts",value:null!==(o=e.notify_raids)&&void 0!==o&&o,onChange:function(t){return e.notify_raids=t}}].map((function(e,t){return r.a.createElement(U.a,{key:t,control:r.a.createElement(z.a,{defaultChecked:e.value,onChange:function(t){return e.onChange(t.target.checked)},name:e.label}),label:e.label})}))})))}function we(){return r.a.createElement(se.Consumer,null,(function(e){var t,n,i;return r.a.createElement(ue,null,r.a.createElement(he.a,{id:"user_name",label:"Twitch Username",required:!0,defaultValue:null!==(t=e.user_name)&&void 0!==t?t:"",onChange:function(t){return e.user_name=t.target.value}}),r.a.createElement(he.a,{id:"client_id",label:"Client ID",required:!0,defaultValue:null!==(n=e.client_id)&&void 0!==n?n:"",onChange:function(t){return e.client_id=t.target.value}}),r.a.createElement(he.a,{id:"client_secret",label:"Client Secret",type:"password",required:!0,defaultValue:null!==(i=e.client_secret)&&void 0!==i?i:"",onChange:function(t){return e.client_secret=t.target.value}}))}))}n(94);var ye=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).tabs=[{title:"Camera",icon:r.a.createElement(L.a,null)},{title:"Spotify",icon:r.a.createElement(L.d,null)},{title:"Twitch",icon:r.a.createElement(L.e,null)}],i.state={selected_tab:0},i}return Object(_.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(M.a,{className:"window"},r.a.createElement(D.a,{position:"relative"},r.a.createElement(T.a,{variant:"dense"},r.a.createElement(q.a,{"aria-label":"close",edge:"start",color:"inherit",onClick:function(t){var n,i;t.stopPropagation(),null===(n=e.props)||void 0===n||null===(i=n.onClose)||void 0===i||i.call(n)}},r.a.createElement(P.a,null)),r.a.createElement(N.a,{variant:"fullWidth",value:this.state.selected_tab,onChange:function(t,n){return e.setState((function(e){return Object(j.a)({},e,{selected_tab:n})}))}},this.tabs.map((function(e,t){return r.a.createElement(I.a,{key:t,icon:e.icon})}))))),[r.a.createElement(M.a,{padding:"20px 15px"},r.a.createElement(de,null)),r.a.createElement(M.a,{padding:"20px 15px"},r.a.createElement(_e,null)),r.a.createElement(M.a,{padding:"20px 15px"},r.a.createElement(pe,null))][this.state.selected_tab])}}]),n}(i.Component),ge=n(411),ke=(n(350),function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var r;return Object(v.a)(this,n),(r=t.call(this,e)).camera_service=void 0,r.video_ref=void 0,r.video_ref=Object(i.createRef)(),r.state={},r}return Object(_.a)(n,[{key:"componentDidMount",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n,i=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.camera_service=this.context,null==this.video_ref.current){e.next=13;break}return e.prev=2,e.next=5,navigator.mediaDevices.getUserMedia({video:{deviceId:null===(t=this.camera_service)||void 0===t?void 0:t.media_device_id}});case 5:n=e.sent,this.video_ref.current.srcObject=n,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:this.video_ref.current.addEventListener("loadeddata",(function(){var e;null===(e=i.video_ref.current)||void 0===e||e.play()}));case 13:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n,i=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.video_ref.current){e.next=12;break}return e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:null===(t=this.camera_service)||void 0===t?void 0:t.media_device_id}});case 4:n=e.sent,this.video_ref.current.srcObject=n,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:this.video_ref.current.addEventListener("loadeddata",(function(){var e;null===(e=i.video_ref.current)||void 0===e||e.play()}));case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,n;return r.a.createElement("div",{className:"face-cam window",style:(null===(e=this.camera_service)||void 0===e?void 0:e.enabled)?{}:{marginBottom:"0px"}},null===(t=this.state)||void 0===t?void 0:t.error_msg,(null===(n=this.camera_service)||void 0===n?void 0:n.enabled)?r.a.createElement("video",{ref:this.video_ref}):null)}}]),n}(i.Component));ke.contextType=ie;var Ee=n(202),xe=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).timer=void 0,i.state={i:-1},i}return Object(_.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.setState((function(e){return Object(j.a)({},e,{i:0})})),this.timer=Object(Q.a)(this.props.update_frequency,this.props.update_frequency).subscribe((function(t){return e.setState((function(e){return Object(j.a)({},e,{i:t})}))}))}},{key:"componentWillUnmount",value:function(){var e;null===(e=this.timer)||void 0===e||e.unsubscribe()}},{key:"render",value:function(){var e;return r.a.createElement("div",Object.assign({},this.props,{title:null===(e=this.state)||void 0===e?void 0:e.i.toString()}),this.props.time.toRelative({style:"narrow"}))}}]),n}(i.Component);xe.defaultProps={update_frequency:6e4};n(351);var Oe=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return Object(_.a)(n,[{key:"render",value:function(){return r.a.createElement(ue,{className:"notification",style:{display:this.props.visible?void 0:"none"}},r.a.createElement(le,{className:"header"},null!=this.props.icon_url?r.a.createElement("img",{className:"icon",src:this.props.icon_url,alt:"app icon"}):null,r.a.createElement("div",{className:"name"},this.props.name),r.a.createElement("div",{className:"spacer"}),null!=this.props.time?r.a.createElement(xe,{className:"time",update_frequency:3e4,time:this.props.time}):null),r.a.createElement("div",{className:"body"},this.props.children))}}]),n}(i.Component);Oe.defaultProps={visible:!0};n(352);var je=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e,i){var r;return Object(v.a)(this,n),(r=t.call(this,e)).spotify_service=void 0,r._timer=void 0,r.state={timestamp:u.DateTime.local(),playing:!1},r}return Object(_.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.spotify_service=this.context,this._timer=Object(Q.a)(0,6e4).subscribe(Object(h.a)(d.a.mark((function t(){var n,i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null===(n=e.spotify_service)||void 0===n?void 0:n.enabled)){t.next=5;break}return t.next=3,e.spotify_service.getSpotifyStatus();case 3:null!=(i=t.sent)&&e.setState((function(e){var t,n,r,a,o,s,c;return Object(j.a)({},e,{playing:i.is_playing,song_name:null===(t=i.item)||void 0===t?void 0:t.name,artist_name:null===(n=i.item)||void 0===n||null===(r=n.artists)||void 0===r?void 0:r.slice(0,(null===(a=i.item)||void 0===a?void 0:a.artists.length)<=3?null===(o=i.item)||void 0===o?void 0:o.artists.length:3).map((function(e){return e.name})).join(", "),album_name:null===(s=i.item)||void 0===s?void 0:s.album.name,album_art_url:null===(c=i.item)||void 0===c?void 0:c.album.images[2].url})}));case 5:case"end":return t.stop()}}),t)}))))}},{key:"componentWillUnmount",value:function(){var e;null===(e=this._timer)||void 0===e||e.unsubscribe()}},{key:"render",value:function(){return r.a.createElement(Oe,{name:"Spotify",icon_url:"https://lh3.googleusercontent.com/UrY7BAZ-XfXGpfkeWg0zCCeo-7ras4DCoRalC_WXXWTK9q5b0Iw7B0YQMsVxZaNB7DM=s180",visible:null!=this.state.song_name},r.a.createElement(le,{className:"status"},r.a.createElement("div",{className:"album-art",style:{backgroundImage:"url('".concat(this.state.album_art_url,"')")}}),r.a.createElement(ue,{className:"info",style:{justifyContent:"center"}},r.a.createElement("div",{className:"song-name"},this.state.song_name),r.a.createElement("div",{className:"artist-name"},this.state.artist_name),r.a.createElement("div",{className:"album-name"},this.state.album_name)),r.a.createElement("div",{className:"play-status"},this.state.playing?r.a.createElement(L.c,null):r.a.createElement(L.b,null))))}}]),n}(i.Component);je.contextType=ae,je.defaultProps={refresh_interval:u.Duration.fromObject({minutes:1})};n(353);var Se=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).twitch_service=void 0,i.state={followers:[]},i}return Object(_.a)(n,[{key:"componentDidMount",value:function(){this.twitch_service=this.context,this.subscribeTwitch()}},{key:"subscribeTwitch",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n,i,r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=this.twitch_service)||void 0===t?void 0:t.subscribe();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0);case 8:return e.prev=8,null===(n=this.twitch_service)||void 0===n||null===(i=n.new_follower)||void 0===i||i.subscribe((function(e){console.log("Notifications got a new follower"),r.setState((function(t){return Object(j.a)({},t,{followers:[e].concat(Object(Ee.a)(t.followers))})}))})),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[0,5,8,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.followers.map((function(e,t){return r.a.createElement(Oe,{key:t.toString(),name:"New Follower",time:u.DateTime.fromJSDate(e.followDate)},e.userDisplayName," just followed!")}));return e.push(r.a.createElement(je,{key:"spotify"})),r.a.createElement("div",{className:"notifications"},e.sort((function(e,t){return null==e.props.time?-1:null==t.props.time?1:t.props.time.diff(e.props.time).valueOf()})))}}]),n}(i.Component);Se.contextType=se;n(354);function Ce(e){return r.a.createElement("div",Object.assign({},e,{className:[e.className,"side-bar"].join(" ")}),r.a.createElement(Se,null),r.a.createElement(ke,null))}n(355),n(356);var De=function(e){Object(C.a)(n,e);var t=Object(S.a)(n);function n(){var e;Object(v.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).test=Object(i.createRef)(),e}return Object(_.a)(n,[{key:"componentDidMount",value:function(){this.setState({})}},{key:"render",value:function(){var e,t,n,i,a,o,s,c,l,u,f,d=null===(e=this.test.current)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.offsetWidth,h=null===(n=this.test.current)||void 0===n||null===(i=n.parentElement)||void 0===i?void 0:i.offsetHeight,v=null===(a=this.test.current)||void 0===a||null===(o=a.parentElement)||void 0===o?void 0:o.offsetTop,_=null===(s=this.test.current)||void 0===s||null===(c=s.parentElement)||void 0===c?void 0:c.offsetLeft,m=window.innerWidth-((null!==(l=null===(u=this.test.current)||void 0===u||null===(f=u.parentElement)||void 0===f?void 0:f.offsetLeft)&&void 0!==l?l:0)+(null!==d&&void 0!==d?d:0));return r.a.createElement("div",{className:"portal-size",ref:this.test,onClick:function(e){return e.stopPropagation()}},r.a.createElement("div",null,null!==d&&void 0!==d?d:"?","\xd7",null!==h&&void 0!==h?h:"?"),r.a.createElement("div",{className:"details"},r.a.createElement("div",null,"Top: ",null!==v&&void 0!==v?v:"?"),r.a.createElement("div",null,"Left: ",null!==_&&void 0!==_?_:"?"),r.a.createElement("div",null,"Right: ",0!==m?m:"?")))}}]),n}(i.Component);function Te(){var e=Object(i.useState)(!1),t=Object(l.a)(e,2),n=t[0],a=t[1];return r.a.createElement("div",{className:"game-portal window active",onClick:function(){return a(!n)}},n?r.a.createElement(De,null):null)}n(357);function Ne(){var e=Object(i.useState)(!1),t=Object(l.a)(e,2),n=t[0],a=t[1];return r.a.createElement("div",{className:"overlay"},r.a.createElement(le,{style:{height:"100vh",justifyContent:"space-between"}},r.a.createElement(Ce,{onClick:function(){return a(!0)}}),r.a.createElement(Te,null)),r.a.createElement(ge.a,{open:n,onClose:function(){return a(!1)},PaperProps:{style:{backgroundColor:"transparent",borderRadius:"unset"}}},r.a.createElement(ye,{onClose:function(){return a(!1)}})))}n(358);var Ie=function(){return r.a.createElement(ce,null,r.a.createElement(s.a,null,r.a.createElement(c.c,null,r.a.createElement(c.a,{exact:!0,path:"/"},r.a.createElement(Ne,null)),r.a.createElement(c.a,{path:"/oauth/spotify"},r.a.createElement(x,null)),r.a.createElement(c.a,{path:"/oauth/twitch"},r.a.createElement(O,null)),r.a.createElement(c.a,{path:"/settings"},r.a.createElement(fe,null,r.a.createElement(ye,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ie,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},93:function(e,t,n){},94:function(e,t,n){}},[[223,1,2]]]);
//# sourceMappingURL=main.83506f2e.chunk.js.map